SELECT SUBSTR(DID, 1, 1),COUNT(DISTINCT A.PID)
  FROM SSA.T_PERSON A
  JOIN SSA.T_CONTRACT  B
    ON A.PID = B.PID
    WHERE b.ENDDATE >= TO_DATE('20180930', 'yyyymmdd')
   AND a.ENDDATE >= TO_DATE('20180930', 'yyyymmdd')
 GROUP BY SUBSTR(DID, 1, 1)
