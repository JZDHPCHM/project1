SELECT 
       SUBSTR(E_BDS_BIDM_MGECMP.INNERORGCODE, 1, 4),
       SUM(NVL(E_BDS_BIDM_KPI.ENDPSNNUM,0))
  FROM (SELECT INNERORGCODE FROM E_BDS_BIDM_MGECMP) E_BDS_BIDM_MGECMP,
       (SELECT *
          FROM E_BDS_BIDM_KPI T
         WHERE TO_NUMBER(T.DATEID) <=
               TO_NUMBER(TO_CHAR((SYSDATE - 1), 'YYYYMM'))) E_BDS_BIDM_KPI,
       (SELECT T.COMPANYNO || T.BRANCH AS ORI,
               T.AREACODE,
               T.LONGDESC,
               O.INNERORGCODE,
               O.ORIGORGCODE,
               D.PROVINCECHNNAME,
               D.BRANCHCHNNAME
       FROM E_BDS_BIDM_FC_AREACODE T,
          E_BDS_BIDM_ORGMAP      O,
               E_BDS_BIDM_MGECMP      D
         WHERE O.ORIGORGCODE = T.COMPANYNO || T.BRANCH
           AND O.INNERORGCODE = D.INNERORGCODE
        
        ) E_BDS_BIDM_FC_AREACODE,
       (SELECT * FROM E_BDS_BIDM_MGECMP_MAP) E_BDS_BIDM_MGECMP_MAP
 WHERE (E_BDS_BIDM_KPI.ADD_BKCOD(+) = E_BDS_BIDM_FC_AREACODE.AREACODE)
   AND (E_BDS_BIDM_FC_AREACODE.INNERORGCODE =
       E_BDS_BIDM_MGECMP.INNERORGCODE(+))
   AND (E_BDS_BIDM_MGECMP.INNERORGCODE =
       E_BDS_BIDM_MGECMP_MAP.BRANCHCOMCODE)
   AND ((E_BDS_BIDM_KPI.DATEID ='201809'  OR E_BDS_BIDM_KPI.DATEID IS NULL) AND
       E_BDS_BIDM_MGECMP_MAP.PROVINCECOMCODE LIKE '86')
    GROUP BY    SUBSTR(E_BDS_BIDM_MGECMP.INNERORGCODE, 1, 4)
