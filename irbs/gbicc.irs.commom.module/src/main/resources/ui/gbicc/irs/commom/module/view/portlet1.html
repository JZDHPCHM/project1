<!DOCTYPE html>
<html
	th:replace="template/bootstrap/bootstrap.html::html(removeNavbar=true)">

<head>
<title
	th:text="#{org.wsp.framework.installer.i18n.title(#{application.title})}"></title>
<script type="text/javascript"
	th:src="@{/webjars/echarts/js/echarts.min.js}"></script>
<style type="text/css">
.btn-startRating {
	background-image: url([(@{/ image/ btn_startRating.jpg
}

)]);
width
:
171px;

			
height
:
74px;

			
border
:
0px;

			
margin-top
:
10px;

		
}
.btn-startDefault {
	background-image: url([(@{/ image/ btn_startDefault.jpg
}

)]);
width
:
171px;

			
height
:
74px;

			
border
:
0px;

			
margin-left
:
180px

		
}
.btn-startRebirDefault {
	background-image: url([(@{/ image/ btn_startRebirDefault.jpg
}

)]);
width
:
171px;

			
height
:
74px;

			
border
:
0px;

			
margin-left
:
180px

		
}
.btn-messageSetting {
	background-image: url([(@{/ image/ btn_messageSetting.jpg
}

)]);
width
:
87px;

			
height
:
43px;

			
border
:
0px;

		
}
.btn-indexDownload {
	background-image: url([(@{/ image/ btn_indexDownload.jpg
}

)]);
width
:
87px;

			
height
:
43px;

			
border
:
0px;

		
}
.div-topButtonPanel {
	text-align: center;
	border: 0px solid;
	border-radius: 10px;
	-moz-border-radius: 25px;
	border-color: rgb(156, 156, 156);
}

.row-topButtonRow {
	background-color: #FFFFFF;
	border-radius: 4px;
	-moz-border-radius: 4px;
	border-color: rgb(156, 156, 156);
	margin-left: 2px;
	margin-right: 2px;
	margin-top: 10px;
	margin-bottom: 10px;
}

.chartPanel {
	width: 100%;
	height: 300px;
	text-align: center;
	border: 1px solid;
	border-color: #F0F0F0;
	border-radius: 4px;
	-moz-border-radius: 4px;
	margin: 0px;
	padding: 0px;
}

.radarChartPanel {
	width: 100%;
	height: 400px;
	text-align: center;
	border: 1px solid;
	border-color: #F0F0F0;
	border-radius: 4px;
	-moz-border-radius: 4px;
	margin: 0px;
	padding: 0px;
}

.bg {
	/*background-color:#FFFFF;*/
	background-color: #F0F0F0;
	padding-left: 20px;
	padding-right: 20px;
}
</style>
</head>
<body class="bg">
	<!-- 第一行,任务信息和图表 -->
	<div class="row">
		<!-- 任务和信息区 -->
		<div class="col-xs-3">
			<div class="panel panel-info" style="margin-top: 20px">
				<div class="panel-heading">
					<b>任务列表</b>
				</div>
				<ul class="nav nav-pills">
					<li class="active"><a data-toggle="pill" href="#backlogTask">待办任务</a></li>
					<li><a data-toggle="pill" href="#doneTask">已办任务</a></li>
					<li><a data-toggle="pill" href="#completeTask">已完成任务</a></li>
				</ul>
				<div class="tab-content">
					<div id="backlogTask" class="tab-pane fade in active">
						<table class="table table-striped">
							<thead>
								<tr>
									<th>客户名称</th>
									<th>任务类型</th>
									<th>任务时间</th>
								</tr>
							</thead>
							<tbody id="taskD">
								<!--   <tr th:each="task : ${taskList}" >
						      <td th:text="${task.CUSTNAME}" 
						      onclick="parent.window.location.href=${task.TASKTYPE}" ></td>
						      <td th:text="${task.TASKTYPE}"></td>
						      <td th:text="${task.TASKDATE}"></td>
						    </tr> -->
							</tbody>
						</table>
					</div>
					<div id=doneTask class="tab-pane fade">
						<table class="table table-striped">
							<thead>
								<tr>
									<th>客户名称</th>
									<th>任务类型</th>
									<th>任务时间</th>
								</tr>
							</thead>
							<tbody id="taskYB">
							</tbody>
						</table>
						<!-- 	<ul class="list-group">
						<li class="list-group-item" style="border:0px;" th:each="task : ${doneTaskList}">
							<a th:href="|javascript:void(0)|" th:text="${task.PROCESSNAME}"></a>
							<th:block th:if="${task.TASKNUM>5}">
							<span class="badge badge-success" style="background-color:red" th:text="${task.TASKNUM}">14</span>
							</th:block>
							<th:block th:unless="${task.TASKNUM>5}">
							<span class="badge badge-success" style="background-color:green" th:text="${task.TASKNUM}"></span>
							</th:block>
						</li>
					</ul> -->
					</div>
					<div id="completeTask" class="tab-pane fade">
						<!-- <ul class="list-group">
						<li class="list-group-item" style="border:0px;" th:each="task : ${completeTaskList}">
							<a th:href="|javascript:void(0)|" th:text="${task.PROCESSNAME}"></a>
							<th:block th:if="${task.TASKNUM>5}">
							<span class="badge badge-success" style="background-color:red" th:text="${task.TASKNUM}">14</span>
							</th:block>
							<th:block th:unless="${task.TASKNUM>5}">
							<span class="badge badge-success" style="background-color:green" th:text="${task.TASKNUM}"></span>
							</th:block>
						</li>
					</ul> -->
						<table class="table table-striped">
							<thead>
								<tr>
									<th>客户名称</th>
									<th>任务类型</th>
									<th>任务时间</th>
								</tr>
							</thead>
							<tbody id="taskYWC">
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<div class="panel panel-info" style="padding: 0px">
				<div class="panel-heading">
					<b>消息列表</b>
				</div>

				<ul class="nav nav-pills">
					<li class="active"><a data-toggle="pill" href="#myMessage">我的消息</a></li>
					<li><a data-toggle="pill" href="#myNotice">我的公告</a></li>
				</ul>
				<div class="tab-content">
					 <div id="myMessage" class="tab-pane fade in active">
						<ul class="list-group" id="msg">
						</ul>
						<span><a href="javascript:;" 
						onclick="parent.window.location.href=''+FrameworkUiInterface.webContextPath+'/system/notification/my-notification.html'">更多</a></span>
					</div>
					 <div id="myNotice" class="tab-pane fade">
						<ul class="list-group" id="announcement">
						</ul>
						<span><a href="javascript:;" 
						onclick="parent.window.location.href=''+FrameworkUiInterface.webContextPath+'/system/announcement/announcement.html'">更多</a></span>
					</div>
					
				</div>
			</div>
		</div>
		<!-- 快捷按钮、图表区 -->
		<div class="col-xs-9" style="padding-left: 0px">

			<div class="panel panel-info"
				style="margin-top: 20px; height: 180px; width: 98%">
				<div class="panel-heading">
					<h3 class="panel-title">快速入口</h3>
				</div>
				<!-- 第一行 快捷操作按钮 -->
				<div class="row">
					<div class="col-xs-4">
						<div class="div-topButtonPanel" style="margin-top: 20px">
							<button type="button" class="btn btn-info btn-lg"
								style="height: 90px"
								onclick="parent.window.location.href=''+FrameworkUiInterface.webContextPath+'/irs/defaultCustomerMan/defaultCustomerStart.html?skin=Tahoe'">发起违约认定</button>

							<!-- <button type="button" class="btn-startRating" onclick="parent.window.location.href='/irs/companyRating/companyRating.html'"></button>
					 		<button type="button" class="btn-startDefault" onclick="parent.window.location.href='/irs/defaultCustomerMan/defaultCustomerStart.html'"></button>
							<button type="button" class="btn-startRebirDefault" onclick="parent.window.location.href='/irs/rebirthDefaultCustomerMan/rebirthDefaultCustomerStart.html'"></button> -->
						</div>
					</div>
					<div class="col-xs-4">
						<div class="div-topButtonPanel" style="margin-top: 20px">
							<button type="button" class="btn btn-info btn-lg"
								style="height: 90px"
								onclick="parent.window.location.href=''+FrameworkUiInterface.webContextPath+'/irs/rebirthDefaultCustomerMan/rebirthDefaultCustomerStart.html?skin=Tahoe'">发起违约重生</button>
						</div>
					</div>
					<div class="col-xs-4">
						<div class="div-topButtonPanel" style="margin-top: 20px">
							<button type="button" class="btn btn-info btn-lg"
								style="height: 90px"
								onclick="parent.window.location.href=''+FrameworkUiInterface.webContextPath+'/irs/companyRating/companyRating.html'">公司客户评级查询</button>




						</div>
					</div>
				</div>
			</div>
			<!-- 第一行 评级分布图表 -->
			<div class="row">
				<div class="col-xs-12" style="margin-top: 20px; width: 98%">
					<div class="panel panel-info">
						<div class="panel-heading">
							<h3 class="panel-title" >
							<span  id="belongsBank"> </span>
							<span class="panel-title" style="float: right;" id="belongsDate"></span>
							</h3>
						</div>
					<!-- 	<select class="form-control" id="changeRating"  style="width: 200px;">
					<option value="rating">公司客户评级分布</option>
					<option value="syfb">分支机构风险调整收率分布</option>
				</select> -->
						<div id="ratingDistribution" class="chartPanel"></div>
					</div>
				</div>
			</div>
			<!-- 选择客户表单 -->
			<div class="row">
				<!-- 前五大客户模块 -->
				<div class="col-xs-12">
					<div class="panel panel-info" style="width: 98%">
						<div class="panel-heading">
							<h3 class="panel-title">
							前五大客户
							<span class="panel-title" style="float: right;" id="QwdDate"></span>
							</h3>
							
						</div>
						<!-- 第一行 选择客户-->
						<div class="row" style="margin-top: 20px; margin-left: 10px">
							<div class="col-xs-3">
								<select class="form-control" id="orderCust"
									placeholder=".col-xs-6">
									<!--  <option th:text="${task.custName}"></option> -->
									<option th:each="cust : ${custOreder}"
										th:value="${cust.FD_CUSTNO}" th:text="${cust.FD_CUSTNAME}"></option>
								</select>
							</div>
							<div class="col-xs-2" style="margin-top: 7px">
								<label id="amt"></label>
							</div>
							<div class="col-xs-2" style="margin-top: 7px">
								<label id="dqpj"></label>
							</div>
							<div class="col-xs-2" style="margin-top: 7px">
								<label id="wygl"></label>
							</div>
							<div class="col-xs-2" style="margin-top: 7px">
								<label id="raroc">RAROC:6.5%</label>
							</div>
						</div>
						<!-- 第二行 定量、定性雷达图 -->
						<div class="row" style="padding-top: 15px;">
							<div class="col-xs-5">
								<div class="panel panel-warning">
									<div class="panel-heading">
										<h3 class="panel-title">定量分析</h3>
									</div>
									<div id="DLIndex" class="radarChartPanel"></div>
								</div>
							</div>
							<div class="col-xs-5">
								<div class="panel panel-warning">
									<div class="panel-heading">
										<h3 class="panel-title">定性分析</h3>
									</div>
									<div id="DXIndex" class="radarChartPanel"></div>
								</div>
							</div>
							<div class="col-xs-2">
								<div class="panel panel-danger">
									<div class="panel-heading">
										<h3 class="panel-title">风险关注点</h3>
									</div>
									<div>
										<ul class="list-group list-group-flush">
											<li class="list-group-item" id="gzd1"></li>
											<li class="list-group-item" id="gzd2"></li>
											<li class="list-group-item" id="gzd3"></li>
										</ul>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>



	<!-- Modal -->
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog"
		aria-labelledby="myModalLabel">
		<div class="modal-dialog" role="document">
			<div class="modal-content" style="width: 400px;">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title" id="myModalLabel">信息</h4>
				</div>
				<div class="modal-body" id="details">
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
				</div>
			</div>
		</div>
	</div>

</body>

<script>



	queryTask();
	function msgDetail(ID) {
		$.post('[(@{/commom/index/queryDetails})]', {
			id : ID
		}, function(data) {
			var html = "";
			html += '<span>id:' + data.FD_ID + '</span> </br>';
			html += '<span>发送时间:' + data.FD_SEND_DATE + '</span> </br>';
			html += '<span>发送人:' + data.FD_SENDER + '</span> </br>';
			html += '<span>接收人:' + data.FD_RECEIVER + '</span> </br>';
			html += '<span>标题:' + data.FD_TITLE + '</span> </br>';
			html += '<span>内容:' + data.FD_CONTENT + '</span>';
			$("#details").html(html);
		});
	}

	function queryTask() {
		//我的公告
		$.post('[(@{/commom/index/queryAnnouncement})]',{},function(data) {
							var html = "";
							$.each(data,function(i, row) {
							html += '<li class="list-group-item "onclick="" style="border:0px;" data-toggle="modal">'
						+ row.FD_TITLE
						+ '</li>';
											})
							$("#announcement").html(html);
						});
		//我的消息
		$.post('[(@{/commom/index/queryMsg})]',{},function(data) {
							var html = "";
							$.each(data,function(i, row) {
							html += '<li class="list-group-item" onclick="msgDetail(\''
						+ row.FD_ID
						+ '\')" style="border:0px;" data-toggle="modal" data-target="#myModal">'
						+ row.FD_TITLE
						+ '</li>';
											})
							$("#msg").html(html);
						});

		$.post(
						'[(@{/commom/index/queryTask})]',
						{},
						function(data) {
							var html = "";
							$
									.each(
											data,
											function(i, row) {
												html += '<tr  >';
												html += '<td> <a href="javascript:;" style="cursor:pointer" onclick="parent.window.location.href=\''+FrameworkUiInterface.webContextPath+""+row.URL+'\'">' + row.FD_CUSTNAME
														+ '</a></td>';
												html += '<td>' + row.TYPE
														+ '</td>';
												html += '<td>' + row.TASKDATE
														+ '</td></tr> ';
											})
							$("#taskD").html(html);
						});

		//已办
		$
				.post(
						'[(@{/commom/index/haveToDoTask})]',
						{},
						function(data) {
							var html = "";
							$
									.each(
											data,
											function(i, row) {
												html += '<tr>';
												html += '<td><a href="javascript:;" style="cursor:pointer" onclick="parent.window.location.href=\''+FrameworkUiInterface.webContextPath+""+row.URL+'\'">'
														+ row.FD_CUSTNAME
														+ '</a></td>';
												html += '<td>' + row.TYPE
														+ '</td>';
												html += '<td>' + row.TASKDATE
														+ '</td></tr> ';
											})
							$("#taskYB").html(html);
						});

		$
				.post(
						'[(@{/commom/index/completedTask})]',
						{},
						function(data) {
							var html = "";
							$
									.each(
											data,
											function(i, row) {
												html += '<tr>';
												html += '<td><a href="javascript:;" style="cursor:pointer"  onclick="parent.window.location.href=\''+FrameworkUiInterface.webContextPath+""+row.URL+'\'" >'
														+ row.FD_CUSTNAME
														+ '</a></td>';
												html += '<td>' + row.TYPE
														+ '</td>';
												html += '<td>' + row.TASKDATE
														+ '</td></tr> ';
											})
							$("#taskYWC").html(html);
						});
	}

	var a = document.getElementById("orderCust");//mySelect是select 的Id
	if(a.options[0]){
		changeLible(a.options[0].value);
		custScore(a.options[0].value);
	}
	ratingGroup();
	initPage();
	function initPage(){
		$.post('[(@{/commom/index/parameter})]', {
		}, function(data) {
			if(data=="1"){
				ratingGroup();
			}else{
				ratingFxfb();
			}
		});
	}
	
	
	$("#orderCust").change(function() {
		var value = $("#orderCust").val();
		changeLible(value);
		custScore(value);
	})

	function changeLible(value) {
		$.post('[(@{/commom/index/findCustNo})]', {
			custNo : value
		}, function(data) {
			$("#amt").text("授信额度:" + data.FD_CRDT_AMT);
			$("#dqpj").text("当前评级:" + data.FD_FIN_LEVEL);
			$("#wygl").text("违约概率:" + data.FD_PD);
			$("#raroc").text("RAROC:8%");
			$("#QwdDate").text("信息更新时间:"+data.qudUpdateDate);
			
		});
	}

	function custScore(value) {
		$.post('[(@{/commom/index/custScore})]', {
			custNo : value
		}, function(data) {
			$("#gzd1").text(data[8][0]);
			$("#gzd2").text(data[8][1]);
			$("#gzd3").text(data[8][2]);
			if(data[6].length==0){
				return "";
			}
			var DLIndexOption = {
				tooltip : {},
				legend : {
					x : 'left',
					data : [ '目标企业', '行业均值' ]
				},
				radar : {
					// shape: 'circle',
					name : {
						textStyle : {
							color : '#fff',
							backgroundColor : '#999',
							borderRadius : 3,
							padding : [ 3, 5 ]
						}
					},
					indicator : data[6]
				},
				series : [ {
					name : '目标企业 VS 行业均值',
					type : 'radar',
					data : [ {
						value : data[2],
						name : '目标企业'
					}, {
						value : data[4],
						name : '行业均值'
					} ]
				} ]
			};

			var DLIndex = echarts.init(document.getElementById('DLIndex'),
					'light');
			DLIndex.setOption(DLIndexOption);
			var DXIndexOption = {
				tooltip : {},
				legend : {
					x : 'left',
					data : [ '目标企业', '行业均值' ]
				},
				radar : {
					// shape: 'circle',
					name : {
						textStyle : {
							color : '#fff',
							backgroundColor : '#999',
							borderRadius : 3,
							padding : [ 3, 5 ]
						}
					},
					indicator : data[7]
				},
				series : [ {
					name : '目标企业 VS 行业均值',
					type : 'radar',
					// areaStyle: {normal: {}},
					data : [ {
						value : data[3],
						name : '目标企业'
					}, {
						value : data[5],
						name : '行业均值'
					} ]
				} ]
			};
			var DXIndex = echarts.init(document.getElementById('DXIndex'),
					'light');
			DXIndex.setOption(DXIndexOption);

		});
	}
	function ratingGroup() {
		$.post('[(@{/commom/index/ratingGroup})]', {}, function(data) {
			$("#belongsBank").text(data[0]);
			//$("#belongsDate").text(data[3]);
			var dataAxis = data[1];
			var data = data[2];
			var yMax = 20;
			var ratingDistributionOption = {
				/*  title: {
				     text: 'XX分行评级分布'
				 }, */
				toolbox : {
					/* feature : {
						saveAsImage : {}
					} */
				},
				xAxis : {
					name : '等级',
					data : dataAxis,
					z : 10
				},
				yAxis : {
					name : '客户数'
				},
				series : [ {
					type : 'bar',
					barWidth : 30,//柱图宽度
					data : data
				} ]
			};
			var ratingDistribution = echarts.init(document
					.getElementById('ratingDistribution'), 'light');
			ratingDistribution.setOption(ratingDistributionOption);
		});

	}
	
	
	function ratingFxfb() {
		$.post('[(@{/commom/index/ratingFxfb})]', {}, function(data) {
			$("#belongsBank").text("风险分布");
			$("#belongsDate").text(data[2]);
			var dataAxis = data[0];
			var data = data[1];
			var yMax = 20;
			var ratingDistributionOption = {
				/*  title: {
				     text: 'XX分行评级分布'
				 }, */
				toolbox : {
					/* feature : {
						saveAsImage : {}
					} */
				},
				xAxis : {
					name : '分行',
					data : dataAxis,
					z : 10
				},
				yAxis : {
					name : '',
					axisLabel:{
						formatter:'{value}%'
					}
				},
				series : [ {
					type : 'bar',
					barWidth : 30,//柱图宽度
					data : data
				} ]
			};
			var ratingDistribution = echarts.init(document
					.getElementById('ratingDistribution'), 'light');
			ratingDistribution.setOption(ratingDistributionOption);
		});

	}
	

	/* ns_company_rating 评级
	 NS_RATING_STEP （QUANTITATIVE-定量、QUALITATIVE_EDIT定性）
	 ns_rating_indexes 指标表 */
	//客户评级表=fd_id=》步骤表=fd_id=》指标表

	//违约客户集中度分布_重点业务品种 报表
	$.get('[(@{/irs/report_reportDefCusBussType/isc/fetch})]', function(
			responseData, status) {
		if ("success" === status) {
			var data = responseData.response.data;

			var xAxiss = new Array();
			var wyNum = new Array(); //违约客户数目数据
			var bnsxYe = new Array();//表内授信余额
			var wyZb = new Array(); //违约客户数目占比
			var bnyeZb = new Array(); //表内授信余额占比

			for (var i = 0; i < data.length; i++) {
				//获取x坐标
				xAxiss[i] = data[i].businessVar;
				wyNum[i] = data[i].overdueguestNum;
				bnsxYe[i] = data[i].balanceintable;
				wyZb[i] = data[i].overdueguestGrop;
				bnyeZb[i] = data[i].balanceintableGrop;
			}
			// 指定图表的配置项和数据
			var option = {
				// 全局调色盘
				color : chartsColor,
				title : {
					text : '违约客户集中度分布_重点业务品种'
				},
				toolbox : {
					feature : {
						saveAsImage : {}
					}
				},
				tooltip : {},
				legend : {
					top : 50,
					data : [ '违约客户数目', '表内授信余额', '违约客户数目占比', '表内授信余额占比' ]
				},
				xAxis : {
					data : xAxiss
				},
				yAxis : [ {
					type : 'value',
					name : '数量'
				}, {
					type : 'value',
					name : '占比',
					axisLabel : {
						formatter : '{value} %'
					}
				} ],
				series : [ {
					name : '违约客户数目',
					type : 'bar',
					data : wyNum
				}, {
					name : '表内授信余额',
					type : 'bar',
					data : bnsxYe
				}, {
					name : '违约客户数目占比',
					type : 'line',
					yAxisIndex : 1,
					data : wyZb
				}, {
					name : '表内授信余额占比',
					type : 'line',
					yAxisIndex : 1,
					data : bnyeZb
				} ]
			};

			var myChart1 = echarts.init(document.getElementById('myChart1'),
					'light');
			myChart1.setOption(option);
		}
	});
</script>
</html>